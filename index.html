<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Deteksi Objek & Warna</title>

<!-- FONT -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">

<!-- TENSORFLOW -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

<style>
    body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: #f8e0e6; 
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
    }

    .container {
        background: #d9b59d;
        padding: 20px;
        border-radius: 20px;
        box-shadow: 0 0 20px rgba(0,0,0,0.2);
        text-align: center;
        width: 420px;
    }

    h2 {
        color: #5b3a29;
        margin-bottom: 10px;
        font-weight: 600;
    }

    video, canvas {
        width: 360px;
        height: 270px;
        border-radius: 15px;
        background: #fff;
    }

    #resultBox {
        margin-top: 15px;
        background: #fff7f7;
        padding: 10px;
        border-radius: 12px;
        font-size: 16px;
        color: #5b3a29;
        min-height: 40px;
        box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    button {
        margin-top: 10px;
        padding: 10px 20px;
        background: #e78ca8;
        border: none;
        color: white;
        font-size: 16px;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s;
    }

    button:hover {
        background: #d46b8d;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Deteksi Objek & Warna</h2>

    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <button onclick="startDetection()">Mulai Deteksi</button>

    <div id="resultBox">Menunggu deteksi...</div>
</div>

<script>
    let model;

    /* ============================
       FUNGSI BUKA KAMERA
    =============================*/
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            const video = document.getElementById("video");
            video.srcObject = stream;

            return new Promise(resolve => {
                video.onloadedmetadata = () => resolve();
            });

        } catch (e) {
            alert("Gagal membuka kamera! Aktifkan izin kamera.");
            console.log(e);
        }
    }

    /* ============================
       FUNGSI DETEKSI WARNA (RATA-RATA)
    =============================*/
        function detectColor(ctx, x, y, w, h) {
        const imgData = ctx.getImageData(x, y, w, h).data;
    
        let rSum = 0, gSum = 0, bSum = 0;
        let count = imgData.length / 4;
    
        for (let i = 0; i < imgData.length; i += 4) {
            rSum += imgData[i];
            gSum += imgData[i + 1];
            bSum += imgData[i + 2];
        }
    
        const r = rSum / count;
        const g = gSum / count;
        const b = bSum / count;
    
        // Dominansi
        const max = Math.max(r, g, b);
        const min = Math.min(r, g, b);
    
        // === MERAH ===
        if (r === max && r - g > 40 && r - b > 40) return "Merah";
    
        // === HIJAU ===
        if (g === max && g - r > 40 && g - b > 40) return "Hijau";
    
        // === BIRU TERANG ===
        if (b === max && b - r > 50 && b - g > 50 && b > 150) return "Biru";
    
        // === BIRU TUA ===
        if (b === max && b < 150 && (r + g) < b) return "Biru Tua";
    
        // === KUNING ===
        if (r > 180 && g > 180 && b < 120) return "Kuning";
    
        // === UNGU ===
        if (r > 120 && b > 120 && g < 100) return "Ungu";
    
        // === HITAM ===
        if (r < 70 && g < 70 && b < 70) return "Hitam";
    
        // === PUTIH ===
        if (r > 200 && g > 200 && b > 200) return "Putih";
    
        // === COKLAT ===
        if (r > 120 && g < 100 && b < 80) return "Coklat";
    
        return "Tidak diketahui";
    }

             
        
    


    /* ============================
       FUNGSI MULAI DETEKSI
    =============================*/
    async function startDetection() {
        const video = document.getElementById("video");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        document.getElementById("resultBox").innerText = "Memuat model...";

        if (!model) model = await cocoSsd.load();

        document.getElementById("resultBox").innerText = "Model siap! Mendeteksi...";

        async function detectFrame() {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const predictions = await model.detect(canvas);

            ctx.lineWidth = 2;
            ctx.font = "14px Poppins";

            if (predictions.length > 0) {
                let info = "";

                predictions.forEach(pred => {
                    const [x, y, w, h] = pred.bbox;

                    ctx.strokeStyle = "#ff4f8b";
                    ctx.strokeRect(x, y, w, h);

                    const warna = detectColor(ctx, x, y, w, h);

                    info += `Objek: ${pred.class} - Warna: ${warna}\n`;

                    ctx.fillStyle = "#ff4f8b";
                    ctx.fillText(`${pred.class} - ${warna}`, x, y - 5);
                });

                document.getElementById("resultBox").innerText = info;

            } else {
                document.getElementById("resultBox").innerText = "Tidak ada objek terdeteksi";
            }

            requestAnimationFrame(detectFrame);
        }

        detectFrame();
    }

    startCamera();
</script>

</body>
</html>
